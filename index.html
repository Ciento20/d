<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=0.68, maximum-scale=1.0, user-scalable=no">
  <title>Smart TV Stream - Pro Player</title>
  <style>
    :root {
      /* Colores base din√°micos */
      --primary: #2563eb;
      --primary-rgb: 37, 99, 235;
      --primary-light: rgba(var(--primary-rgb), 0.2);
      --primary-dark: #1e50c7;
      
      --bg-dark: #0f0f0f;
      --card-bg: #1a1a1a;
      --sidebar-bg: #0a0a0a;
      --text: #f8fafc;
      --text-dim: #94a3b8;
      --border-color: #2e2e2e;
      --radius-md: 12px;
      --radius-sm: 8px;
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
    }
    
    body.dark-mode {
      --bg-dark: #0f0f0f;
      --card-bg: #1a1a1a;
      --text: #f8fafc;
    }

    body {
      background: var(--bg-dark);
      color: var(--text);
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      margin: 0;
      padding: 0;
      overflow-x: hidden;
      transition: background 0.3s;
    }

    /* LOADER DISCRETO */
    #loader-container {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 4px;
      background: var(--border-color);
      z-index: 9999;
      transition: opacity 0.5s ease;
    }

    .loader-bar {
      height: 100%;
      width: 30%;
      background: var(--primary);
      box-shadow: 0 0 10px var(--primary);
      animation: loading-slide 2s infinite ease-in-out;
    }

    @keyframes loading-slide {
      0% { transform: translateX(-100%); width: 10%; }
      50% { width: 40%; }
      100% { transform: translateX(1000%); width: 10%; }
    }

    .loader-text-overlay {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: var(--card-bg);
      padding: 10px 20px;
      border-radius: 50px;
      border: 1px solid var(--primary);
      font-size: 0.8rem;
      z-index: 9999;
      box-shadow: var(--shadow-lg);
    }

    .app-container {
      display: flex;
      flex-direction: row;
      min-height: 100vh;
      opacity: 1;
    }

    .loading-finished #loader-container,
    .loading-finished .loader-text-overlay {
      opacity: 0;
      visibility: hidden;
    }

    /* BARRA LATERAL */
    .sidebar {
      width: 80px;
      background: var(--sidebar-bg);
      border-right: 1px solid var(--border-color);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2rem 0;
      position: fixed;
      height: 100vh;
      z-index: 1000;
      transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .sidebar:hover { width: 200px; }

    .main-content {
      flex: 1;
      margin-left: 80px;
      padding: 1rem 2rem;
      width: calc(100% - 80px);
      display: flex;
      flex-direction: column;
    }

    /* FILTROS */
    .dynamic-filters {
      display: flex;
      gap: 10px;
      overflow-x: auto;
      padding: 10px 0 20px 0;
      scrollbar-width: none;
    }
    .dynamic-filters::-webkit-scrollbar { display: none; }

    .filter-chip {
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      color: var(--text);
      padding: 8px 16px;
      border-radius: 20px;
      cursor: pointer;
      white-space: nowrap;
      transition: all 0.2s;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .filter-chip:hover {
      border-color: var(--primary);
      background: var(--primary-light);
    }

    .filter-chip--active {
      background: var(--primary) !important;
      color: white;
      border-color: var(--primary);
    }

    /* REPRODUCTOR */
    .player-section {
      margin-bottom: 2rem;
      border-radius: var(--radius-md);
      overflow: hidden;
      background: #000;
    }

    .player-container {
      aspect-ratio: 16 / 9;
      width: 100%;
      display: none;
    }

    .player-container--active { display: block; }
    #videoFrame { width: 100%; height: 100%; border: none; }

    .player-controls {
      background: var(--card-bg);
      padding: 1rem;
      display: none;
      align-items: center;
      justify-content: center;
      gap: 15px;
    }

    .player-controls--active { display: flex; }

    /* BOTONES NAVEGACI√ìN */
    .nav-group {
      display: flex;
      flex-direction: column;
      gap: 0.8rem;
      width: 100%;
      padding: 0 10px;
    }

    .filter-button {
      background: transparent;
      border: none;
      color: var(--text-dim);
      padding: 0.8rem;
      border-radius: var(--radius-sm);
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 15px;
      transition: all 0.2s;
      width: 100%;
      overflow: hidden;
      white-space: nowrap;
    }

    .sidebar span { opacity: 0; transition: opacity 0.2s; pointer-events: none; }
    .sidebar:hover span { opacity: 1; pointer-events: auto; }

    .filter-button:hover { background: var(--primary-light); color: var(--text); }
    .filter-button--active { background: var(--primary) !important; color: white !important; }

    /* BUSCADOR */
    .search-container {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 1rem;
      max-width: 560px;
    }

    .search-box { flex: 1; }
    .search-box input {
      width: 100%;
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      padding: 0.8rem 1.5rem;
      border-radius: 50px;
      color: white;
      outline: none;
    }

    .clear-filters-btn {
      width: 45px; height: 45px; border-radius: 50%;
      border: 1px solid var(--border-color);
      background: var(--card-bg); color: var(--text);
      cursor: pointer; display: flex; align-items: center; justify-content: center;
    }

    /* --- NUEVA CUADR√çCULA DE CAT√ÅLOGO --- */
    .grid-layout {
      display: grid;
      /* Define columnas autom√°ticas que se ajustan al tama√±o m√≠nimo de 180px */
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 1.2rem;
      padding: 1rem 0;
    }

    .grid-layout .channel-card {
      min-width: 0; /* Permite que la card se encoja al tama√±o de la celda */
      margin: 0;
    }

    /* CARRUSELES (Originales para Inicio/Directos) */
    .channel-group { margin-bottom: 2.5rem; }
    .channel-group__header { margin-bottom: 1rem; padding-left: 0.5rem; }
    .channel-group__title { font-size: 1.2rem; font-weight: bold; display: flex; align-items: center; gap: 10px; }
    .channel-group__sport { color: var(--primary); font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 4px; }

    .channel-group__content {
      display: flex;
      overflow-x: auto;
      gap: 1.2rem;
      padding: 1rem 0.5rem;
      scrollbar-width: none;
    }
    .channel-group__content::-webkit-scrollbar { display: none; }

    .channel-card {
      min-width: 220px;
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      padding: 1.2rem;
      cursor: pointer;
      transition: transform 0.3s ease, border-color 0.3s;
      flex-shrink: 0;
    }

    .channel-card:hover {
      transform: translateY(-5px);
      border-color: var(--primary);
      box-shadow: 0 0 15px var(--primary-light);
    }

    .channel-name { font-weight: 700; text-align: center; margin: 8px 0; font-size: 0.95rem; }
    .channel-number { font-size: 0.7rem; color: var(--primary); font-weight: bold; text-align: center; }
    .channel-time { font-size: 0.8rem; color: var(--text-dim); text-align: center; }
    .channel-time--live::before {
      content: ""; display: inline-block; width: 8px; height: 8px;
      background: #ff0000; border-radius: 50%; margin-right: 6px;
      animation: pulse 1.5s infinite;
    }

    /* MODALES */
    .modal {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.85);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 2000;
    }
    .modal--active { display: flex; }
    .modal__content {
      background: #1a1a1a;
      padding: 2rem;
      border-radius: var(--radius-md);
      width: 90%;
      max-width: 400px;
      border: 1px solid #333;
    }

    .settings-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.2rem;
    }

    .color-picker { display: flex; gap: 10px; margin-top: 5px; }
    .color-option {
        width: 32px; height: 32px;
        border-radius: 50%; border: 2px solid #555;
        cursor: pointer; transition: transform 0.2s;
    }
    .color-option.active { border-color: white; outline: 2px solid var(--primary); }

    .settings-switch { position: relative; width: 44px; height: 22px; }
    .settings-switch input { opacity: 0; width: 0; height: 0; }
    .settings-slider {
      position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0;
      background-color: #333; transition: .4s; border-radius: 34px;
    }
    .settings-slider:before {
      position: absolute; content: ""; height: 16px; width: 16px;
      left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%;
    }
    input:checked + .settings-slider { background-color: var(--primary); }
    input:checked + .settings-slider:before { transform: translateX(22px); }

    @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }

    @media (max-width: 768px) {
      .sidebar {
        width: 100%; height: 65px; bottom: 0; top: auto;
        flex-direction: row; border-right: none; border-top: 1px solid var(--border-color);
        padding: 0;
      }
      .sidebar:hover { width: 100%; }
      .nav-group { flex-direction: row; justify-content: space-around; padding: 0; height: 100%; gap: 0; }
      .filter-button { justify-content: center; padding: 0; height: 100%; font-size: 1.4rem; gap: 0; }
      .main-content { margin-left: 0; margin-bottom: 80px; padding: 1rem; }
      .sidebar span { display: none !important; }
      .search-container { max-width: 100%; }
      .grid-layout { grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 0.8rem; }
    }
  </style>
</head>
<body>

  <div id="loader-container">
    <div class="loader-bar"></div>
  </div>

  <div class="loader-text-overlay" id="loader-status">üì° Sincronizando canales...</div>

  <div class="app-container">
    <nav class="sidebar">
      <div class="nav-group">
        <button class="filter-button" id="filterFavorites">‚≠ê <span>Favoritos</span></button>
        <button class="filter-button filter-button--active" id="filterAll">üè† <span>Inicio</span></button>
        <button class="filter-button" id="filterCatalog">üìö <span>Cat√°logo</span></button>
        <button class="filter-button" id="filterLive">üî¥ <span>Directo</span></button>
        <button class="filter-button" id="openSettingsBtn">‚öôÔ∏è <span>Ajustes</span></button>
      </div>
    </nav>

    <main class="main-content">
      <div class="search-container">
        <div class="search-box">
          <input type="text" id="searchInput" placeholder="Busca un canal o evento...">
        </div>
        <button class="clear-filters-btn" id="clearFiltersBtn" title="Limpiar todos los filtros">x</button>
      </div>

      <div class="dynamic-filters" id="dynamicFilters"></div>

      <div class="player-section">
        <div class="player-container" id="playerContainer">
          <iframe id="videoFrame" allowfullscreen></iframe>
        </div>
        <div class="player-controls" id="playerControls">
          <span id="channelInfo" style="color: var(--primary); font-weight: bold;"></span>
          <button class="filter-button" id="prevChannelBtn" style="width: auto;">‚óÑ</button>
          <button class="filter-button" id="nextChannelBtn" style="width: auto;">‚ñ∫</button>
          <button class="filter-button" id="favoriteBtn" style="width: auto;">‚òÖ</button>
          <button class="filter-button" id="closePlayerBtn" style="width: auto;">√ó</button>
        </div>
      </div>

      <div id="fechaContainer">
        <h2 id="fecha">Actualizando programaci√≥n...</h2>
      </div>

      <div id="results"></div>
    </main>
  </div>

  <div class="modal" id="settingsModal">
    <div class="modal__content">
      <h2 style="margin-top: 0;">‚öôÔ∏è Ajustes</h2>
      
      <div style="margin-bottom: 1.5rem;">
        <span style="display: block; margin-bottom: 8px;">Color del Tema</span>
        <div class="color-picker">
            <button class="color-option" data-color="#2563eb" style="background:#2563eb"></button>
            <button class="color-option" data-color="#dc2626" style="background:#dc2626"></button>
            <button class="color-option" data-color="#16a34a" style="background:#16a34a"></button>
            <button class="color-option" data-color="#79006f" style="background:#79006f"></button>
            <button class="color-option" data-color="#ea580c" style="background:#ea580c"></button>
        </div>
      </div>

      <div class="settings-item">
        <span>Modo Oscuro</span>
        <label class="settings-switch">
          <input type="checkbox" id="darkModeToggle">
          <span class="settings-slider"></span>
        </label>
      </div>

      <div class="settings-item">
        <span>Filtrar Internacional</span>
        <label class="settings-switch">
          <input type="checkbox" id="internationalFilterToggle">
          <span class="settings-slider"></span>
        </label>
      </div>

      <div style="margin-bottom: 1.5rem;">
        <span style="display: block; margin-bottom: 8px;">Fuente de Reproductor</span>
        <select id="baseDomainSelect" style="width: 100%; padding: 10px; background: #333; color: white; border: 1px solid #444; border-radius: 8px;">
          <option value="yeahstreams.com/plus/">YeahStreams</option>
          <option value="daddyhd.com/casting/">DaddyHD</option>
          <option value="abbasport.online/footy.php?id=">AbbaSport</option>
          <option value="footballschedule.online/albaplayer/">AlbaPlayer</option>
          <option value="daddylives.top/watch.php?id=">DaddyLives</option>
        </select>
      </div>

      <button class="filter-button" id="syncAutoNamesBtn" style="background: #333; margin-bottom: 10px; justify-content: center;">üîÑ Sincronizar nombres 24/7</button>
      <button class="filter-button" id="closeSettingsBtn" style="background: var(--primary); color: white; justify-content: center;">Guardar y Cerrar</button>
    </div>
  </div>

  <script>
    const state = {
      channels: JSON.parse(localStorage.getItem('channelsCache')) || [],
      lastHtmlHash: localStorage.getItem('lastHtmlHash') || null,
      autoNamesMap: JSON.parse(localStorage.getItem('autoNamesMap')) || {},
      currentChannel: null,
      currentFilter: 'all',
      sportFilter: null,
      searchTerm: '',
      favorites: JSON.parse(localStorage.getItem('favorites')) || [],
      customNames: JSON.parse(localStorage.getItem('customNames')) || {},
      baseDomain: localStorage.getItem('baseDomain') || 'daddylives.top/watch.php?id=',
      internationalFilter: localStorage.getItem('internationalFilter') === 'true',
      darkMode: localStorage.getItem('darkMode') !== 'false',
      primaryColor: localStorage.getItem('miWeb_color') || '#2563eb',
      filteredKeywords: ["Cricket", "Russia", "Golf", "NZ", "BR", "Morocco", "Arabic", "Astro", "Willow", "SuperSport", "Star Sports", "Sony Ten", "France", "Turkiye", "Turkey", "Portugal", "Serbia", "MENA", "DE", "Croatia", "Brasil", "Israel", "Italy", "Poland", "NL"],
      searchTimeout: null,
      sportEmojis: {"TV SHOWS": "üì∫", "SOCCER": "‚öΩ", "CRICKET": "üèè", "TENNIS": "üéæ", "MOTORSPORT": "üèÅ", "BADMINTON": "üè∏", "MMA": "üëä", "AM. FOOTBALL": "üèà", "NBA": "‚õπÔ∏è", "VOLLEYBALL": "üèê"},
      proxies: ["https://api.allorigins.win/raw?url=", "https://api.codetabs.com/v1/proxy/?quest=", "https://corsproxy.io/?", "https://thingproxy.freeboard.io/fetch/"]
    };

    function hexToRgb(hex) {
        const r = parseInt(hex.slice(1, 3), 16);
        const g = parseInt(hex.slice(3, 5), 16);
        const b = parseInt(hex.slice(5, 7), 16);
        return { r, g, b };
    }

    function changeThemeColor(color) {
        const rgb = hexToRgb(color);
        document.documentElement.style.setProperty('--primary', color);
        document.documentElement.style.setProperty('--primary-rgb', `${rgb.r}, ${rgb.g}, ${rgb.b}`);
        localStorage.setItem('miWeb_color', color);
        state.primaryColor = color;
        document.querySelectorAll('.color-option').forEach(btn => btn.classList.toggle('active', btn.getAttribute('data-color') === color));
    }

    function setAppReady() { document.body.classList.add('loading-finished'); }

    function hashCode(str) {
      let hash = 0;
      for (let i = 0; i < str.length; i++) { hash = ((hash << 5) - hash) + str.charCodeAt(i); hash |= 0; }
      return hash.toString();
    }

    async function fetchWithFallback(targetUrl) {
      for (const proxy of state.proxies) {
        try {
          const response = await fetch(proxy + encodeURIComponent(targetUrl));
          if (!response.ok) throw new Error();
          const data = await response.text();
          if (data && data.length > 100) return data;
        } catch (e) { console.warn(`Proxy fall√≥: ${proxy}`); }
      }
      throw new Error('Error de conexi√≥n');
    }

    async function syncAutoNames() {
      try {
        const html = await fetchWithFallback("https://daddylives.top/24-7-channels/");
        const doc = new DOMParser().parseFromString(html, "text/html");
        const map = {};
        doc.querySelectorAll(".gi").forEach(el => {
          const name = el.querySelector(".text")?.textContent.trim();
          const num = el.querySelector(".num")?.textContent.trim();
          if (num && name) map[num] = name;
        });
        state.autoNamesMap = map;
        localStorage.setItem('autoNamesMap', JSON.stringify(map));
        renderResults();
      } catch (e) { console.error("Error sincronizando nombres:", e); }
    }

    function getDisplayName(channel) {
      if (!channel) return "Desconocido";
      return state.customNames[channel.number] || state.autoNamesMap[channel.number] || channel.name || `Canal ${channel.number}`;
    }

    function getSportWithEmoji(sportName) {
      if (!sportName) return "üì∫ TV";
      const upperSport = sportName.toUpperCase();
      for (const [key, emoji] of Object.entries(state.sportEmojis)) {
        if (upperSport.includes(key)) return `${sportName} ${emoji}`;
      }
      return sportName;
    }

    function adjustTime(time) {
      if (!time || time === 'LIVE') return time;
      const [h, m] = time.split(':').map(Number);
      return `${String((h + 1) % 24).padStart(2, '0')}:${String(m).padStart(2, '0')}`;
    }

    function isChannelLive(channel) {
      if (channel.time === 'LIVE') return true;
      if (!channel.time) return false;
      const now = new Date();
      const current = now.getHours() * 60 + now.getMinutes();
      const adjusted = adjustTime(channel.time);
      const [h, m] = adjusted.split(':').map(Number);
      return current >= (h * 60 + m) - 15 && current <= (h * 60 + m) + 120;
    }

    function playChannel(channel) {
      state.currentChannel = channel;
      document.getElementById('playerContainer').classList.add('player-container--active');
      document.getElementById('playerControls').classList.add('player-controls--active');
      document.getElementById('channelInfo').textContent = getDisplayName(channel);
      
      const favBtn = document.getElementById('favoriteBtn');
      favBtn.textContent = state.favorites.includes(channel.number) ? '‚òÖ' : '‚òÜ';
      favBtn.style.color = state.favorites.includes(channel.number) ? '#fbbf24' : 'var(--text-dim)';

      const frame = document.getElementById('videoFrame');
      const streamUrl = state.baseDomain.includes('php?id=') ? 
        `https://${state.baseDomain}${channel.number}` : 
        `https://${state.baseDomain}stream-${channel.number}.php`;
      
      frame.src = streamUrl;
      window.scrollTo({top: 0, behavior: 'smooth'});
    }

    function navigateEventChannel(direction) {
      if (!state.currentChannel) return;
      const eventChannels = state.channels.filter(c => state.currentChannel.event && c.event === state.currentChannel.event);

      if (eventChannels.length > 1) {
        const currentIndex = eventChannels.findIndex(c => c.number === state.currentChannel.number);
        let nextIndex = direction === 'next' ? (currentIndex + 1) % eventChannels.length : (currentIndex - 1 + eventChannels.length) % eventChannels.length;
        playChannel(eventChannels[nextIndex]);
      } else {
        const currentNum = parseInt(state.currentChannel.number);
        if (isNaN(currentNum)) return;
        const nextNum = direction === 'next' ? currentNum + 1 : currentNum - 1;
        if (nextNum < 1) return;
        let nextChannel = state.channels.find(c => parseInt(c.number) === nextNum) || {
            number: nextNum.toString(),
            name: state.autoNamesMap[nextNum.toString()] || `Canal ${nextNum}`,
            event: 'Canal directo', sport: 'TV', time: ''
        };
        playChannel(nextChannel);
      }
    }

    function renderResults() {
      const resultsDiv = document.getElementById('results');
      let sourceList = state.channels;

      if (state.currentFilter === 'catalog') {
        const allKnownNumbers = new Set([...state.channels.map(c => c.number), ...Object.keys(state.autoNamesMap)]);
        sourceList = Array.from(allKnownNumbers).map(num => {
            const cached = state.channels.find(c => c.number === num);
            return cached || { number: num, name: state.autoNamesMap[num] || `Canal ${num}`, event: 'Disponible en Cat√°logo', sport: 'TV 24/7', time: '' };
        }).sort((a, b) => parseInt(a.number) - parseInt(b.number));
      }

      const filtered = sourceList.filter(c => {
        const displayName = getDisplayName(c).toLowerCase();
        if (state.sportFilter && c.sport !== state.sportFilter) return false;
        if (state.currentFilter === 'favorites' && !state.favorites.includes(c.number)) return false;
        if (state.currentFilter === 'live' && !isChannelLive(c)) return false;
        if (state.searchTerm && !displayName.includes(state.searchTerm.toLowerCase()) && c.number !== state.searchTerm) return false;
        if (state.internationalFilter && state.filteredKeywords.some(kw => displayName.includes(kw.toLowerCase()))) return false;
        return true;
      });

      if (filtered.length === 0) {
        resultsDiv.innerHTML = `<div class="no-results-container"><div class="no-results">üì° No se encontraron canales</div></div>`;
        return;
      }

      if (state.currentFilter === 'catalog') {
        // RENDER MODO CAT√ÅLOGO (Cuadr√≠cula Multicolumna)
        resultsDiv.innerHTML = `
          <div class="channel-group">
            <div class="channel-group__header">
              <div class="channel-group__sport">üì¶ Cat√°logo</div>
              <div class="channel-group__title">Todos los canales 24/7</div>
            </div>
            <div class="grid-layout">
              ${filtered.map(c => `
                <div class="channel-card" onclick='playChannel(${JSON.stringify(c)})'>
                  <div class="channel-number">CH ${c.number}</div>
                  <div class="channel-name">${getDisplayName(c)}</div>
                </div>
              `).join('')}
            </div>
          </div>`;
      } else {
        // RENDER MODO NORMAL (Carruseles por Evento)
        const groups = {};
        filtered.forEach(c => {
          const key = `${c.event}|${c.time}|${c.sport}`;
          if (!groups[key]) groups[key] = [];
          groups[key].push(c);
        });
        
        resultsDiv.innerHTML = Object.entries(groups).map(([key, channels]) => {
          const [event, time, sport] = key.split('|');
          return `
            <div class="channel-group">
              <div class="channel-group__header">
                <div class="channel-group__sport">${getSportWithEmoji(sport)}</div>
                <div class="channel-group__title">
                  ${time.trim() ? `<span class="channel-time ${time === 'LIVE' ? 'channel-time--live' : ''}">${adjustTime(time)}</span>` : ''}
                  ${event}
                </div>
              </div>
              <div class="channel-group__content">
                ${channels.map(c => `
                  <div class="channel-card" onclick='playChannel(${JSON.stringify(c)})'>
                    <div class="channel-number">CH ${c.number}</div>
                    <div class="channel-name">${getDisplayName(c)}</div>
                  </div>
                `).join('')}
              </div>
            </div>`;
        }).join('');
      }
    }

    async function scrape() {
      try {
        const html = await fetchWithFallback("https://daddylives.top/match-schedule/");
        const doc = new DOMParser().parseFromString(html, "text/html");
        const fechaElemento = doc.querySelector(".daddy-schedule-title");
        if (fechaElemento) document.getElementById('fecha').textContent = fechaElemento.textContent.split('‚Äì')[0].trim();

        const found = [];
        doc.querySelectorAll(".match-category").forEach(cat => {
          let sport = cat.querySelector(".category-title")?.textContent.trim().replace(/\s*\(\d+\)/g, '');
          cat.querySelectorAll(".match-section").forEach(sec => {
            const time = sec.querySelector(".time")?.textContent.trim();
            const event = sec.querySelector(".match-name")?.textContent.trim();
            sec.querySelectorAll(".link-button").forEach(link => {
              const match = link.textContent.trim().match(/CH-(\d+)/i);
              if (match) found.push({ number: match[1], name: link.textContent.trim(), time, event, sport });
            });
          });
        });
        if (found.length > 0) {
          state.channels = found;
          localStorage.setItem('channelsCache', JSON.stringify(found));
        }
        renderResults();
      } catch (e) { document.getElementById('fecha').textContent = "Error de conexi√≥n"; }
      finally { setAppReady(); }
    }

    // EVENTOS
    document.getElementById('searchInput').oninput = (e) => {
      state.searchTerm = e.target.value.trim();
      renderResults();
    };

    document.querySelectorAll('.color-option').forEach(btn => {
      btn.addEventListener('click', () => changeThemeColor(btn.getAttribute('data-color')));
    });

    document.getElementById('syncAutoNamesBtn').onclick = syncAutoNames;
    document.getElementById('nextChannelBtn').onclick = () => navigateEventChannel('next');
    document.getElementById('prevChannelBtn').onclick = () => navigateEventChannel('prev');
    document.getElementById('favoriteBtn').onclick = () => {
      const num = state.currentChannel?.number;
      if (!num) return;
      const idx = state.favorites.indexOf(num);
      idx === -1 ? state.favorites.push(num) : state.favorites.splice(idx, 1);
      localStorage.setItem('favorites', JSON.stringify(state.favorites));
      playChannel(state.currentChannel);
      renderResults();
    };
    
    document.getElementById('openSettingsBtn').onclick = () => document.getElementById('settingsModal').classList.add('modal--active');
    document.getElementById('closeSettingsBtn').onclick = () => document.getElementById('settingsModal').classList.remove('modal--active');
    document.getElementById('closePlayerBtn').onclick = () => {
      document.getElementById('playerContainer').classList.remove('player-container--active');
      document.getElementById('playerControls').classList.remove('player-controls--active');
      document.getElementById('videoFrame').src = '';
      state.currentChannel = null;
    };

    const navButtons = document.querySelectorAll('.nav-group .filter-button');
    function setActiveNav(btnId) {
        navButtons.forEach(b => b.classList.remove('filter-button--active'));
        document.getElementById(btnId).classList.add('filter-button--active');
    }

    document.getElementById('filterAll').onclick = () => { state.currentFilter = 'all'; state.sportFilter = null; setActiveNav('filterAll'); renderResults(); };
    document.getElementById('filterLive').onclick = () => { state.currentFilter = 'live'; setActiveNav('filterLive'); renderResults(); };
    document.getElementById('filterFavorites').onclick = () => { state.currentFilter = 'favorites'; setActiveNav('filterFavorites'); renderResults(); };
    document.getElementById('filterCatalog').onclick = () => { state.currentFilter = 'catalog'; state.sportFilter = null; setActiveNav('filterCatalog'); renderResults(); };

    // INICIALIZACI√ìN
    if(state.darkMode) document.body.classList.add('dark-mode');
    changeThemeColor(state.primaryColor);
    if (Object.keys(state.autoNamesMap).length === 0) syncAutoNames();
    scrape();
  </script>
</body>
</html>
